# py_common

Общие функции для скриптов на Python

Файл **py_common.py** содержит следующие процедуры и функции:

* **read_config** - Чтение конфиг файла библиотеки
* **write_config** - Изменить содержание конфиг файла библиотеки или робота
* **initialize** - Инициализация логгера робота
* **get_conf_name** - Возвращает имя модуля вызвавшего функцию
* **get_conf_path** - Возвращает путь до модуля вызвавшего функцию
* **set_credentials** - Ввод и сохранение учетных данных (логин, пароль) для работы робота
    ```
    import argparse
    parser.add_argument("--setcred", action="store_true", help="Сохранение учетных данных для робота") 
    args = parser.parse_args()

    if args.setcred:
        py_common.set_credentials(['asiz_token', 'ASDOG'])
        return
    ```
* **set_log_labels** - Устанавливает переменные для json журнала. Переменные добавляются в каждую запись журнала
    ```
    # устанавка переменных по умолчанию: task и pid
    py_common.set_log_labels()
    # установка произвольной переменой
    py_common.set_log_labels('espp_request', 'ЗАП24-01685314')
    ```
* **dict_merge** - Рекурсивное объединение двух словарей

классы:

* **json_formatter** - класс для вывода лога в формате json
  
и глобальные переменные:
* **conf** - словарь с конфигураций (на основе конфиг файла)
* **vars** - словарь с дополнительными переменными, необходимыми в процессе работы, в том числе **pm** - модуль по работе с паролями

В файле **config.json** содержатся настройки работы модуля:

* **LogFile** - Путь к файлу журнала работы скрипта. Если значение не указано, журнал сохраняется в каталоге со скриптом, имеет имя скрипта и расширение .log
* **LogFileJson** - Путь к файлу журнала работы скрипта в формате json. Если значение не указано, то файл не создаётся

Для имен лог файлов возможно указание переменных:

* {path}     - каталог скрипта
* {name}     - имя скрипта, без расширения
* {date}     - дата в формате ГГГГММДД
* {datetime} -  дата и время в формате ГГГГММДДччммсс

например
```
"LogFile": "{path}\\logs\\{name}_{datetime}.log",
```

### Настройка PIP для установки библиотек
```
python -m pip config set global.index "http://10.99.253.167:8081/repository/pypi-group/"
python -m pip config set global.index-url "http://10.99.253.167:8081/repository/pypi-group/simple/"
python -m pip config set global.trusted-host "10.99.253.167"
```

